<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PmDataMapper">
	<insert id="insertPmData" parameterType="PmData">
		insert into pmdata(pm25,pm100,time,station)
		values(#{pm25},#{pm100},#{time},#{station}) 
	</insert>
	<select id="PmDataByStation" parameterType="Integer" resultType="PmData">
		select * 
		from pmdata 
		where station = #{station}
	</select>
	<select id="findRecentPmList" resultType="PmData">
		SELECT
		   st.station_name,
		   st.sido,
			pm.*
		FROM station st
		JOIN (SELECT
			   pm.seq,
				pm.station,
				MAX(pm.time) AS recent_time
				FROM pmdata pm
				GROUP BY pm.station
			) rpm
		  ON st.seq = rpm.station
		JOIN pmdata pm 
		  ON rpm.station = pm.station AND rpm.recent_time = pm.time
	</select>
</mapper>